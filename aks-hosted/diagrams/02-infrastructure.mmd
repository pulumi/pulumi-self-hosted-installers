%%{init: {'theme':'base', 'themeVariables': {'fontSize': '18px', 'fontFamily': 'Arial, sans-serif'}}}%%
graph TD
    classDef azure fill:#0078D4,stroke:#FFFFFF,stroke-width:3px,color:#FFFFFF,font-size:14px
    classDef storage fill:#00BCF2,stroke:#FFFFFF,stroke-width:3px,color:#FFFFFF,font-size:14px
    classDef network fill:#7FBA00,stroke:#FFFFFF,stroke-width:3px,color:#FFFFFF,font-size:14px
    classDef security fill:#FFB900,stroke:#232F3E,stroke-width:3px,color:#000000,font-size:14px
    
    subgraph INFRA["01-infrastructure: Foundation"]
        subgraph AD["Azure Active Directory"]
            AD_PRINCIPAL[Azure AD Service Principal<br/>AKS Authentication<br/>Client Credentials]:::security
            AD_ADMIN[Azure AD Admin Group<br/>User Assignment<br/>Role Mapping]:::security
        end
        
        subgraph NET["Azure Virtual Network"]
            VNET[Azure Virtual Network<br/>Custom or Existing VNet<br/>Regional Deployment]:::network
            AKS_SUBNET[AKS Subnet<br/>10.2.1.0/24<br/>Kubernetes Nodes]:::network
            DB_SUBNET[Database Subnet<br/>10.2.2.0/24<br/>Delegated to MySQL]:::network
        end
        
        subgraph DB["Azure Database for MySQL"]
            MYSQL[MySQL Flexible Server<br/>Private DNS Zone<br/>VNet-only Access]:::storage
            DB_PULUMI[MySQL Database<br/>Name: pulumi<br/>Application Schema]:::storage
        end
    end
    
    VNET --> AKS_SUBNET
    VNET --> DB_SUBNET
    DB_SUBNET --> MYSQL
    AD_PRINCIPAL --> VNET